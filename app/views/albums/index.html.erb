<h1 id="title">Memopic</h1>
<% if user_signed_in? %>
  <div class="main-content">
    <div class="user-info">
      <%= current_user.nickname %>
      <%= link_to 'ログアウト', logout_path %>
    </div>
    <div class="album_form">
      <div class="wrapper-button-new-album"><button class="button-new-album">新しいアルバムを作成する</button></div>
      <%= form_with(model: @album_form, url: albums_path, class: "form-new-album") do |form| %>
        <div id="album-name-input">
          <%= form.text_field :name, placeholder: 'タイトルを追加', class: "input-new-album-title", autocomplete:"off" %>
        </div>

        <label class="file-label">
          <span class="filelabel" title="ファイルを選択">
            <span style="color:black">
              <i class="fas fa-plus-circle"></i>
            </span>
            <span style="color: orange">
              <i class="far fa-images fa-4x"></i>
            </span>
          </span>
          <%= form.file_field :pictures, multiple: true, accept: 'image/png,image/gif,image/jpeg', class: 'file-input' %>
        </label>
        <span class='file-count'>画像が選択されていません</span>
        <div class="right">
          <%= button_tag type: 'submit', class: "button-submit", data: { disable_with: "アップロード中" } do %>
            <i class="fas fa-cloud-upload-alt"></i>  アップロードする
          <% end %>
        </div>

      <% end %>
    </div>
    <div class="albums">
      <% @albums.zip(@thumbpics).each do |album, thumbpic| %>
        <%= render partial: "album" ,locals: {album: album, thumbpic: thumbpic} %>
      <% end %>
    </div>
  </div>
<% end %>
<script src="https://kit.fontawesome.com/81a1ab3943.js" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script type="text/javascript">
  $(function () {
    $('.button-new-album').on('click', () => {
      $('.form-new-album').slideToggle(alertFunc);
    });
    function alertFunc(){
      if ($(this).css('display') != 'none') {
        $(".button-new-album").text("▲ 閉じる");
        $(".button-new-album").css('color', 'orange')
        $(".button-new-album").css('background', 'white')
      }else{
        $(".button-new-album").text("新しいアルバムを作成する");
        $(".button-new-album").css('color', '#fff')
        $(".button-new-album").css('background', 'linear-gradient(45deg, #FFC107 0%, #ff8b5f 100%)')
      }
    };
  });
</script>
<script type="text/javascript">
$(function () {
  $('.file-input').on('change', function (e) {
      let fileCount = $(this).get(0).files.length
      if(fileCount > 0){
        $('.file-count').text(String(fileCount) + '個の画像が選択されています');
      }else{
        $('.file-count').text('画像が選択されていません');
      }
    });
  });
</script>
